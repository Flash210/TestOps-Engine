# ============================================
# Scheduled Nightly Test Run
# ============================================
# This workflow runs tests automatically every night
# Useful for catching issues early with comprehensive test coverage

name: Nightly Regression Tests

# ============================================
# TRIGGER: Runs on Schedule
# ============================================
on:
  # Cron syntax: minute hour day month weekday
  # This runs at 2 AM UTC every day
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC
  
  # Allow manual trigger
  workflow_dispatch:

# ============================================
# JOBS
# ============================================
jobs:
  nightly-tests:
    name: ðŸŒ™ Nightly Full Test Suite
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
      
      - name: ðŸ“¦ Install Dependencies
        run: npm ci
      
      - name: ðŸŽ­ Install Playwright Browsers
        run: npx playwright install --with-deps
      
      # Run ALL tests (no tag filtering)
      - name: ðŸ§ª Run Full Test Suite
        run: npm test
        continue-on-error: true
      
      - name: ðŸ“Š Upload Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: nightly-test-results-${{ github.run_number }}
          path: test-results/
          retention-days: 90  # Keep nightly reports longer
      
      # Send notification on failure (optional)
      - name: ðŸ“§ Notify on Failure
        if: failure()
        run: |
          echo "ðŸš¨ Nightly tests failed!"
          echo "Check results at: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          # You can add Slack/Teams/Email notifications here

# ============================================
# SCHEDULE EXAMPLES
# ============================================
# '0 2 * * *'        - Daily at 2 AM UTC
# '0 2 * * 1-5'      - Weekdays at 2 AM UTC
# '0 */6 * * *'      - Every 6 hours
# '0 0 * * 0'        - Weekly on Sunday at midnight
# '0 9,17 * * 1-5'   - Weekdays at 9 AM and 5 PM UTC
